<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" />
    <title>Basic &lt;mux-video/&gt; example</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
    </style>
  </head>
  <body>
    <div>
      <video
        id="media"
        muted
        controls></video>
    </div>
    <div>
      <label for="playbackIdInput">Playback Id</label>
      <input id="playbackIdInput" type="text"/>
      <label for="widthInput">Width</label>
      <input id="widthInput" type="text"/>
      <label for="heightInput">Height</label>
      <input id="heightInput" type="text"/>
    </div>

   <script>
     const params = new URLSearchParams(window.location.search);
     const mediaEl = document.querySelector('#media');

     const playbackIdInput = document.querySelector('#playbackIdInput');
     playbackIdInput.addEventListener('change', () => {
       if (mediaEl.getAttribute('playback-id') !== playbackIdInput.value) {
         mediaEl.setAttribute('playback-id', playbackIdInput.value);
       }
     });
     if (params.has('playback-id')) {
       playbackIdInput.value = params.get('playback-id');
       if (mediaEl.getAttribute('playback-id') !== playbackIdInput.value) {
         mediaEl.setAttribute('playback-id', playbackIdInput.value);
       }
     }

     const widthInput = document.querySelector('#widthInput');
     widthInput.addEventListener('change', () => {
       if (mediaEl.style.width !== widthInput.value) {
         mediaEl.style.width = widthInput.value;
       }
     });
     if (params.has('width')) {
       widthInput.value = params.get('width');
       if (mediaEl.style.width !== widthInput.value) {
         mediaEl.style.width = widthInput.value;
       }
     }

     const heightInput = document.querySelector('#heightInput');
     heightInput.addEventListener('change', () => {
       if (mediaEl.style.height !== heightInput.value) {
         mediaEl.style.height = heightInput.value;
       }
     });

     if (params.has('height')) {
       heightInput.value = params.get('height');
       if (mediaEl.style.height !== heightInput.value) {
         mediaEl.style.height = heightInput.value;
       }
     }
     
   </script>
    <a href="../">Browse Elements</a>
    <script>
      const playbackId = mediaEl.getAttribute('playback-id');
      const toPlaybackIdParts = (playbackIdWithOptionalParams) => {
        const qIndex = playbackIdWithOptionalParams.indexOf('?');
        if (qIndex < 0) return [playbackIdWithOptionalParams];
        const idPart = playbackIdWithOptionalParams.slice(0, qIndex);
        const queryPart = playbackIdWithOptionalParams.slice(qIndex);
        return [idPart, queryPart];
      };
      const toMuxVideoURL = (playbackId) => {
        if (!playbackId) return undefined;
        const [idPart, queryPart = ''] = toPlaybackIdParts(playbackId);
        return `https://stream.mux.com/${idPart}.m3u8${queryPart}`;
      };
      const video = document.querySelector('video');

      const videoSrc = toMuxVideoURL(playbackId);
      if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(videoSrc);
        hls.attachMedia(video);
      }
      // HLS.js is not supported on platforms that do not have Media Source
      // Extensions (MSE) enabled.
      //
      // When the browser has built-in HLS support (check using `canPlayType`),
      // we can provide an HLS manifest (i.e. .m3u8 URL) directly to the video
      // element through the `src` property. This is using the built-in support
      // of the plain video element, without using HLS.js.
      //
      // Note: it would be more normal to wait on the 'canplay' event below however
      // on Safari (where you are most likely to find built-in HLS support) the
      // video.src URL must be on the user-driven white-list before a 'canplay'
      // event will be emitted; the last video event that can be reliably
      // listened-for when the URL is not on the white-list is 'loadedmetadata'.
      else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = videoSrc;
      }
    </script>
  </body>
</html>
